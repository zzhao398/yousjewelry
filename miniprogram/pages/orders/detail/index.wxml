<!-- pages/orders/detail/index.wxml -->

<view class="page">
  <!-- 如果还在加载 & 本地没有数据，可以做个简单 loading，占位一下 -->
  <view wx:if="{{loading && !order}}" class="loading">
    {{tOrderDetail.loading}}
  </view>

  <view wx:if="{{order}}">
    <!-- 顶部：订单号 + 状态 -->
    <view class="card card-header">
      <view class="order-id-row">
        <text class="label">{{tOrderDetail.order_id_label}}</text>
        <text class="order-id">{{order.displayOid}}</text>
      </view>

      <view class="order-sub-row">
        <text class="sub-label">{{tOrderDetail.created_at_label}}</text>
        <text class="sub-text">
          {{order.createdAtText || '--'}}
        </text>
      </view>

      <view wx:if="{{order.paidAtText}}" class="order-sub-row">
        <text class="sub-label">{{tOrderDetail.paid_at_label}}</text>
        <text class="sub-text">{{order.paidAtText}}</text>
      </view>

      <view class="tag-row">
        <view class="status-tag {{order.payTagClass}}">
          {{order.payStatusLabel}}
        </view>
        <view class="status-tag {{order.shipTagClass}}">
          {{order.shipStatusLabel}}
        </view>
      </view>
    </view>

    <!-- 金额信息 -->
    <view class="card">
      <view class="card-title">{{tOrderDetail.section_amount}}</view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.product_amount_label}}</text>
        <text class="amount-value">
          {{order.currency}} {{order.productAmount.toFixed(2)}}
        </text>
      </view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.shipping_price_label}}</text>
        <text class="amount-value">
          {{order.currency}} {{order.shippingPrice.toFixed(2)}}
        </text>
      </view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.coupon_price_label}}</text>
        <text class="amount-value">
          -{{order.currency}} {{order.couponPrice.toFixed(2)}}
        </text>
      </view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.discount_price_label}}</text>
        <text class="amount-value">
          -{{order.currency}} {{order.discountPrice.toFixed(2)}}
        </text>
      </view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.fee_price_label}}</text>
        <text class="amount-value">
          {{order.currency}} {{order.feePrice.toFixed(2)}}
        </text>
      </view>

      <view class="amount-row">
        <text class="amount-label">{{tOrderDetail.tax_price_label}}</text>
        <text class="amount-value">
          {{order.currency}} {{order.taxPrice.toFixed(2)}}
        </text>
      </view>

      <view class="amount-total-row">
        <text class="amount-total-label">{{tOrderDetail.total_label}}</text>
        <text class="amount-total-value">
          {{order.displayAmountText}}
        </text>
      </view>
    </view>

    <!-- 顾客信息 -->
    <view class="card">
      <view class="card-title">{{tOrderDetail.section_customer}}</view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.customer_name_label}}</text>
        <text class="info-value">
          {{order.customerName || tOrderDetail.default_dash}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.customer_email_label}}</text>
        <text class="info-value">
          {{order.customerEmail || tOrderDetail.default_dash}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.customer_country_label}}</text>
        <text class="info-value">
          {{order.customerCountry || tOrderDetail.default_dash}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.customer_ip_label}}</text>
        <text class="info-value">
          {{order.customerIp || tOrderDetail.default_dash}}
        </text>
      </view>
    </view>

    <!-- 配送信息 -->
    <view class="card">
      <view class="card-title">{{tOrderDetail.section_shipping}}</view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.shipping_method_label}}</text>
        <text class="info-value">
          {{order.shippingMethod || tOrderDetail.default_dash}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.shipping_price_label}}</text>
        <text class="info-value">
          {{order.currency}} {{order.shippingPrice.toFixed(2)}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.package_label}}</text>
        <text class="info-value">
          {{tOrderDetail.package_weight_prefix}}{{order.totalWeight}}KG
          {{tOrderDetail.package_qty_prefix}}{{order.itemCount}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.address_label}}</text>
        <text class="info-value">
          {{order.shippingAddress || tOrderDetail.default_dash}}
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">{{tOrderDetail.tracking_label}}</text>
        <text class="info-value">
          {{order.trackingNumber || tOrderDetail.default_dash}}
        </text>
      </view>
    </view>

    <!-- 商品清单 -->
    <view class="card">
      <view class="card-title">{{tOrderDetail.section_items}}</view>

      <view
        wx:if="{{!order.items || !order.items.length}}"
        class="empty-text"
      >
        {{tOrderDetail.items_empty}}
      </view>

      <block wx:for="{{order.items}}" wx:key="index">
        <view class="item-row">
          <image
            wx:if="{{item.pic}}"
            class="item-pic"
            src="{{item.pic}}"
            mode="aspectFill"
          />
          <view class="item-main">
            <view class="item-name">
              {{item.name || tOrderDetail.default_dash}}
            </view>
            <view class="item-sku">
              SKU：{{item.sku || tOrderDetail.default_dash}}
            </view>
            <view class="item-bottom">
              <text class="item-price">
                {{item.currency}} {{item.price.toFixed(2)}}
              </text>
              <text class="item-qty">x {{item.qty}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- 备注 -->
    <view class="card">
      <view class="card-title">{{tOrderDetail.section_notes}}</view>

      <view class="note-row">
        <text class="note-label">{{tOrderDetail.note_customer_label}}</text>
        <text class="note-text">
          {{order.customerNote || tOrderDetail.default_none}}
        </text>
      </view>

      <view class="note-row">
        <text class="note-label">{{tOrderDetail.note_admin_label}}</text>
        <text class="note-text">
          {{order.adminNote || tOrderDetail.default_none}}
        </text>
      </view>
    </view>
  </view>

  <view wx:if="{{!loading && !order}}" class="empty-wrapper">
    <text class="empty-text">{{tOrderDetail.empty_title}}</text>
    <button
      class="empty-btn"
      bindtap="fetchDetail"
      type="default"
      size="mini"
    >
      {{tOrderDetail.empty_btn_reload}}
    </button>
  </view>
</view>
