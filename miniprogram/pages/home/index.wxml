<!-- pages/home/index.wxml -->

<view class="page">

<!-- å³ä¸Šè§’è¯­è¨€åˆ‡æ¢ -->
<view class="lang-switcher">
  <view class="lang-btn" bindtap="onLangButtonTap">
    <text>language è¯­è¨€</text>
  </view>

  <view wx:if="{{langMenuVisible}}" class="lang-menu">
    <view class="lang-item" data-lang="zh" bindtap="onSelectLang">
      <text>{{tCommon.lang_zh}}</text>
    </view>
    <view class="lang-item" data-lang="en" bindtap="onSelectLang">
      <text>{{tCommon.lang_en}}</text>
    </view>
  </view>
</view>

<!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸï¼ˆä¸»æ’­ & ç®¡ç†å‘˜å…±ç”¨ï¼‰ -->
<view class="section-header">
  <text class="section-title">{{tHome.section_title}}</text>
  <text class="section-subtitle">
    <!-- ç®€å•å­—ç¬¦ä¸²æ›¿æ¢ï¼šæŠŠ {{name}} æ›¿æ¢æˆ displayName -->
    {{
      tHome.welcome.replace(
        '{{name}}',
        displayName || (lang === 'zh' ? 'ç”¨æˆ·' : 'User')
      )
    }}
  </text>
</view>

<!-- å¾…å‘è´§å¡ç‰‡ -->
<view class="card card-pending">
  <view class="card-row">
    <view class="card-left">
      <text class="icon-clock">ðŸ•’</text>
      <text class="card-label">{{tHome.pending_label}}</text>
    </view>
    <text class="card-number">{{toShipCount}}</text>
  </view>
</view>

<!-- æ¦‚å†µå¡ç‰‡ï¼ˆä»Šå¤©ï¼‰ -->
<view class="card card-summary">

  <!-- å¡ç‰‡å¤´éƒ¨ -->
  <view class="card-header-row">
    <text class="card-label">{{tHome.summary_label}}</text>
    <view class="tag-today">{{tHome.tag_today}}</view>
  </view>

  <!-- ä¸» GMV å±…ä¸­æ˜¾ç¤º -->
  <view class="summary-main-center">
    <text class="summary-amount">$ {{gmv}}</text>
  </view>

  <!-- ä¸‹æ–¹æŒ‡æ ‡ -->
  <view class="summary-metrics">
    <view class="metric">
      <text class="metric-number">{{orderCount}}</text>
      <text class="metric-label">{{tHome.metric_order_count}}</text>
    </view>
    <view class="metric">
      <text class="metric-number">{{gmv}}</text>
      <text class="metric-label">{{tHome.metric_gmv}}</text>
    </view>
    <view class="metric">
      <text class="metric-number">{{toShipCount}}</text>
      <text class="metric-label">{{tHome.metric_to_ship}}</text>
    </view>
  </view>

</view>

<!-- ===================================================== -->
<!-- è¶‹åŠ¿ + æ—¶é—´èŒƒå›´åˆ‡æ¢ï¼šç®¡ç†å‘˜ + ä¸»æ’­ éƒ½èƒ½çœ‹åˆ°è‡ªå·±çš„è¶‹åŠ¿ -->
<!-- ===================================================== -->
<view wx:if="{{isAdmin || role === 'anchor'}}">
  <view class="section-header">
    <text class="section-title">
      <!-- è¿™é‡Œä¸ºäº†ä¸­è‹±æ–‡éƒ½é€šé¡ºï¼Œç›´æŽ¥ç”¨ä¸åŒè¯­è¨€æ‹¼æŽ¥å†™æ³• -->
      <block wx:if="{{lang === 'zh'}}">
        {{tHome.trend_title_prefix}}
        {{
          range === '7d' ? '7 å¤©' :
          (range === '30d' ? '30 å¤©' :
           (range === '1y' ? '1 å¹´' : tHome.range_all))
        }}
        {{tHome.trend_title_suffix}}
      </block>
      <block wx:else>
        {{
          (range === '7d' ? tHome.range_7d :
           (range === '30d' ? tHome.range_30d :
            (range === '1y' ? tHome.range_1y : tHome.range_all)))
        }} {{tHome.trend_title_suffix}}
      </block>
    </text>
    <text class="section-subtitle">{{tHome.trend_subtitle}}</text>
  </view>

  <!-- æ—¶é—´èŒƒå›´ tabs -->
  <view class="range-tabs">
    <view
      class="range-tab {{range === '7d' ? 'active' : ''}}"
      data-range="7d"
      bindtap="onRangeChange"
    >{{tHome.range_7d}}</view>

    <view
      class="range-tab {{range === '30d' ? 'active' : ''}}"
      data-range="30d"
      bindtap="onRangeChange"
    >{{tHome.range_30d}}</view>

    <view
      class="range-tab {{range === '1y' ? 'active' : ''}}"
      data-range="1y"
      bindtap="onRangeChange"
    >{{tHome.range_1y}}</view>

    <view
      class="range-tab {{range === 'all' ? 'active' : ''}}"
      data-range="all"
      bindtap="onRangeChange"
    >{{tHome.range_all}}</view>
  </view>

  <view class="card card-stats">
    <block wx:if="{{dayStats && dayStats.length}}">
      <view
        class="day-row"
        wx:for="{{dayStats}}"
        wx:key="day"
      >
        <view class="day-left">
          <text class="day-date">{{item.day}}</text>
        </view>
        <view class="day-right">
          <text class="day-orders">
            {{tHome.label_order}} {{item.orderCount}}
          </text>
          <text class="day-gmv">
            {{tHome.label_gmv}} {{item.gmv}}
          </text>
        </view>
      </view>
    </block>

    <view wx:if="{{!dayStats || !dayStats.length}}" class="empty-text">
      {{tHome.empty_day_stats}}
    </view>
  </view>
</view>

<!-- ä¸»æ’­æ¦œå•ï¼ˆæŒ‰ GMV æŽ’åºï¼Œä½¿ç”¨åŒä¸€æ—¶é—´èŒƒå›´ï¼‰â€”â€” ä»…ç®¡ç†å‘˜å¯è§ -->
<view wx:if="{{isAdmin}}">
  <view class="section-header">
    <text class="section-title">{{tHome.anchor_rank_title}}</text>
    <text class="section-subtitle">
      {{tHome.anchor_rank_subtitle}}
    </text>
  </view>

  <view class="card card-stats">
    <block wx:if="{{anchorStats && anchorStats.length}}">
      <view
        class="anchor-row"
        wx:for="{{anchorStats}}"
        wx:key="anchorId"
      >
        <view class="anchor-left">
          <text class="anchor-rank">{{index + 1}}</text>
          <text class="anchor-id">{{item.anchorId}}</text>
        </view>
        <view class="anchor-right">
          <text class="anchor-gmv">
            {{tHome.label_gmv}} {{item.gmv}}
          </text>
          <text class="anchor-orders">
            {{tHome.label_order}} {{item.orderCount}}
          </text>
        </view>
      </view>
    </block>

    <view wx:if="{{!anchorStats || !anchorStats.length}}" class="empty-text">
      {{tHome.empty_anchor_stats}}
    </view>
  </view>
</view>

</view>
